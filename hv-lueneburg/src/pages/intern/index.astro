---
import Layout from '~/layouts/PageLayout.astro';
import { Icon } from 'astro-icon/components';

let errorMessage = '';

if (Astro.request.method === 'POST') {
 const data = await Astro.request.formData();
 const password = data.get('password');
 
 // Simple hardcoded password for now (would be moved to DB/Sanity later)
 if (password === 'NurDerHVL2026!') {
 Astro.cookies.set('hvl_session', 'true', { path: '/', maxAge: 60 * 60 * 24 * 30 }); // 30 days
 return Astro.redirect('/intern/dashboard');
 } else {
 errorMessage = 'Leider ist das Passwort falsch.';
 }
}

const metadata = {
 title: 'Interner Bereich | Login',
};
---

<Layout metadata={metadata}>
 <div class="min-h-screen bg-gray-50 dark:bg-slate-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
 <div class="sm:mx-auto sm:w-full sm:max-w-md animate-fade">
 <div class="flex justify-center mb-6 text-primary">
 <Icon name="tabler:shield-lock" class="w-16 h-16" />
 </div>
 <h2 class="mt-6 text-center text-3xl font-heading font-black text-gray-900 dark:text-white">
 HVL Mitglieder-Portal
 </h2>
 <p class="mt-2 text-center text-gray-600 dark:text-gray-400">
 Bitte melde dich an, um auf vereinsinterne Dokumente, Termine und Bestellungen zuzugreifen.
 </p>
 </div>

 <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md animate-fade" style="animation-delay: 0.2s;">
 <div class="bg-white dark:bg-slate-800 py-8 px-4 shadow-xl sm:rounded-2xl sm:px-10 border border-gray-100 dark:border-slate-700">
 
 {errorMessage && (
 <div class="mb-4 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-4 flex items-start gap-3">
 <Icon name="tabler:alert-triangle" class="w-5 h-5 text-red-500 mt-0.5" />
 <p class=" font-bold text-red-700 dark:text-red-400">{errorMessage}</p>
 </div>
 )}

 <form class="space-y-6" method="POST">
 <div>
 <label for="email" class="block font-medium text-gray-700 dark:text-gray-300">
 E-Mail Adresse
 </label>
 <div class="mt-1">
 <input id="email" name="email" type="email" autocomplete="email" required class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm bg-transparent dark:text-white" placeholder="spieler@hv-lueneburg.de" />
 </div>
 </div>

 <div>
 <label for="password" class="block font-medium text-gray-700 dark:text-gray-300">
 Passwort
 </label>
 <div class="mt-1 relative">
 <input id="password" name="password" type="password" autocomplete="current-password" required class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm bg-transparent dark:text-white" />
 </div>
 <p class="mt-2 text-xs text-gray-500">Das Passwort erh√§ltst du von deinem Trainer.</p>
 </div>

 <div class="flex items-center justify-between">
 <div class="flex items-center">
 <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" />
 <label for="remember-me" class="ml-2 block text-gray-900 dark:text-gray-300">
 Angemeldet bleiben
 </label>
 </div>
 </div>

 <div>
 <button type="submit" class="w-full flex justify-center py-2.5 px-4 border border-transparent rounded-md shadow-md font-bold text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all">
 Einloggen
 </button>
 </div>
 </form>

 <div class="mt-6 relative">
 <div class="absolute inset-0 flex items-center">
 <div class="w-full border-t border-gray-300 dark:border-slate-600"></div>
 </div>
 <div class="relative flex justify-center ">
 <span class="px-2 bg-white dark:bg-slate-800 text-gray-500">Du hast noch keinen Zugang?</span>
 </div>
 </div>

 <div class="mt-6 w-full flex justify-center">
 <a href="mailto:admin@hv-lueneburg.de" class=" font-medium text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
 <Icon name="tabler:mail" class="w-4 h-4" /> Zugang beim Trainer erfragen
 </a>
 </div>
 </div>
 </div>
 </div>
</Layout>
