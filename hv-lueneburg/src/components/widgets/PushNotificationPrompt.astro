---
// Request Push Notifications from the browser

export interface Props {
  // Add props if needed
}
---

<div id="push-notification-banner" class="hidden fixed bottom-4 right-4 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-800 shadow-xl rounded-lg p-5 max-w-sm z-50 animate-fade">
  <div class="flex items-start gap-4">
    <div class="bg-primary/10 text-primary p-2 rounded-full">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M10 5a2 2 0 1 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6"></path>
        <path d="M9 17v1a3 3 0 0 0 6 0v-1"></path>
      </svg>
    </div>
    <div class="flex-1">
      <h3 class="font-semibold text-gray-900 dark:text-white mb-1">Bleibe auf dem Laufenden</h3>
      <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Erhalte Live-Ergebnisse und wichtige News direkt auf dein Gerät.</p>
      <div class="flex gap-2">
        <button id="push-accept" class="text-xs bg-primary hover:bg-primary/90 text-white font-medium py-1.5 px-3 rounded transition-colors w-full">Aktivieren</button>
        <button id="push-decline" class="text-xs bg-gray-100 hover:bg-gray-200 dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-gray-300 text-gray-700 font-medium py-1.5 px-3 rounded transition-colors w-full">Später</button>
      </div>
    </div>
    <button id="push-close" class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 p-1 -m-1">
      <span class="sr-only">Schließen</span>
      <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>
  </div>
</div>

<script>
  // Simple Push Notification Opt-in UI Logic
  document.addEventListener('DOMContentLoaded', () => {
    const banner = document.getElementById('push-notification-banner');
    const acceptBtn = document.getElementById('push-accept');
    const declineBtn = document.getElementById('push-decline');
    const closeBtn = document.getElementById('push-close');
    
    // Check if we already asked
    const hasAsked = localStorage.getItem('hvl_push_asked');
    
    // Check if notifications are supported and not already granted/denied
    if ('Notification' in window && Notification.permission === 'default' && !hasAsked) {
      // Show the banner after a short delay
      setTimeout(() => {
        if(banner) banner.classList.remove('hidden');
      }, 5000);
    }
    
    const hideBanner = () => {
      if(banner) banner.classList.add('hidden');
      localStorage.setItem('hvl_push_asked', 'true');
    };
    
    const requestPermission = async () => {
      try {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
          console.log('Notification permission granted.');
          // TODO: Subscribe utility to VAPID / Push Service goes here
        } else {
          console.log('Notification permission denied.');
        }
        hideBanner();
      } catch (error) {
        console.error('Error requesting notification permission:', error);
      }
    };
    
    if (acceptBtn) acceptBtn.addEventListener('click', requestPermission);
    if (declineBtn) declineBtn.addEventListener('click', hideBanner);
    if (closeBtn) closeBtn.addEventListener('click', hideBanner);
  });
</script>
